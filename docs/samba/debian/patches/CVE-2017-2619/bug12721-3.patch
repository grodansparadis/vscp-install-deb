Backport of:

From ce0efa7d1fcfde14b1af0788f83b369a06a200f2 Mon Sep 17 00:00:00 2001
From: Jeremy Allison <jra@samba.org>
Date: Mon, 27 Mar 2017 22:07:50 -0700
Subject: [PATCH 1/4] s3: Fixup test for CVE-2017-2619 regression with "follow
 symlinks = no"

Use correct bash operators (not string operators).
Add missing "return".

BUG: https://bugzilla.samba.org/show_bug.cgi?id=12721

Signed-off-by: Jeremy Allison <jra@samba.org>
---
 source3/script/tests/test_smbclient_s3.sh | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

Index: samba-4.3.11+dfsg/source3/script/tests/test_smbclient_s3.sh
===================================================================
--- samba-4.3.11+dfsg.orig/source3/script/tests/test_smbclient_s3.sh	2017-03-28 08:33:31.330065648 -0400
+++ samba-4.3.11+dfsg/source3/script/tests/test_smbclient_s3.sh	2017-03-28 08:34:19.310992759 -0400
@@ -1042,7 +1042,7 @@
     ret=$?
     rm -f $tmpfile
 
-    if [ $ret != 0 ] ; then
+    if [ $ret -ne 0 ] ; then
        echo "$out"
        echo "failed accessing nosymlinks with error $ret"
        false
@@ -1051,10 +1051,11 @@
 
     echo "$out" | grep 'NT_STATUS_ACCESS_DENIED'
     ret=$?
-    if [ $ret != 0 ] ; then
+    if [ $ret -ne 0 ] ; then
        echo "$out"
        echo "failed - should get NT_STATUS_ACCESS_DENIED getting \\nosymlinks\\source"
        false
+       return
     fi
 
 # But we should be able to create and delete directories.
@@ -1069,7 +1070,7 @@
     ret=$?
     rm -f $tmpfile
 
-    if [ $ret != 0 ] ; then
+    if [ $ret -ne 0 ] ; then
        echo "$out"
        echo "failed accessing nosymlinks with error $ret"
        false
@@ -1078,7 +1079,7 @@
 
     echo "$out" | grep 'NT_STATUS'
     ret=$?
-    if [ $ret == 0 ] ; then
+    if [ $ret -eq 0 ] ; then
 	echo "$out"
 	echo "failed - NT_STATUS_XXXX doing mkdir a; mkdir a\\b on \\nosymlinks"
 	false
