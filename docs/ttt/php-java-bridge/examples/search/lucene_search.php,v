head	1.11;
access;
symbols
	Release-7-1-1:1.11.0.38
	Root_Release-7-1-1:1.11
	Root_Release_7-0-1:1.11
	Release_7-0-1:1.11.0.36
	Release_7-0-0:1.11.0.34
	Root_Release_7-0-0:1.11
	Release-6-2-2:1.11.0.32
	Release-6-1-2-3:1.11
	Root_Release-6-1-2-3:1.11
	Release-6-1-2-2:1.11.0.30
	Root_Release-6-1-2-2:1.11
	debian_version_6_1_2_1-1:1.11
	upstream_version_6_1_2_1:1.11
	Release-6-1-2-1_new:1.11.0.28
	Root_Release-6-1-2-1_new:1.11
	Release-6-1-2-1:1.11.0.26
	Root_Release-6-1-2-1:1.11
	upstream_version_6_1_2:1.11
	debian_version_6_1_2-1:1.11
	Release-6-1-2:1.11.0.24
	Root_Release-6-1-2:1.11
	debian_version_6_1_1-2:1.11
	debian_version_6_1_1-1:1.11
	upstream_version_6_1_1:1.11
	Release-6-1-1:1.11.0.22
	Root_Release-6-1-1:1.11
	Release-6-0-4:1.11.0.20
	Root_Release-6-0-4:1.11
	Release-6-0-3_NEW:1.11.0.16
	Root_Release-6-0-3_NEW:1.11
	Release-6-0-3:1.11.0.18
	Root_Release-6-0-3:1.11
	Release-6-0-0:1.11.0.14
	Root_Release-6-0-0:1.11
	Release-5-5-4-1:1.11.0.12
	Root_Release-5-5-4-1:1.11
	Release-5-5-4:1.11.0.10
	Root_Release-5-5-4:1.11
	Release-5-5-3:1.11.0.8
	ROOT_Release-5-5-3:1.11
	Release-5-5-2:1.11.0.6
	Root_Release-5-5-2:1.11
	debian_version_5_5_1-1:1.11
	Release-5-5-1:1.11.0.4
	upstream_version_5_5_1:1.11
	ROOT_Release-5-5-1:1.11
	debian_version_5_5-1:1.11
	upstream_version_5_5:1.11
	ROOT_Release-5-5:1.11
	Release-5-5:1.11.0.2
	debian_version_5_4_4_2-3:1.10
	Release-5-4-4-2-1:1.10.0.12
	debian_version_5_4_4_2-2:1.10
	debian_version_5_4_4_2-1:1.10
	upstream_version_5_4_4_2:1.10
	debian_version_5_4_4_1-1:1.10
	upstream_version_5_4_4_1:1.10
	debian_version_5_4_4-1:1.10
	upstream_version_5_4_4:1.10
	Release-5-4-4:1.10.0.14
	Root_Release-5-4-4:1.10
	debian_version_5_4_3_2-1:1.10
	upstream_version_5_4_3_2:1.10
	Release_5-4-3-2:1.10.0.10
	Root_Release_5-4-3-2:1.10
	upstream_version_5_4_3_1:1.10
	debian_version_5_4_3_1-1:1.10
	Release-5-4-3:1.10.0.8
	Root_Release-5-4-3:1.10
	Root_Release-5-4-1:1.10
	Release-5-4-1:1.10.0.6
	Root_Release-5-4:1.10
	Release-5-4:1.10.0.4
	upstream_version_5_3_4:1.10
	debian_version_5_3_4-1:1.10
	ROOT_Release-5-3-4:1.10
	Release-5-3-4:1.10.0.2
	ROOT_Release-5-3-3:1.9
	Release-5-3-3:1.9.0.18
	debian_version_5_3_2_1_2-1:1.9
	upstream_version_5_3_2_1_2:1.9
	debian_version_5_3_2_1_1-1:1.9
	debian_version_5_3_2_1_1:1.9
	upstream_version_5_3_2_1_1:1.9
	Root_Release-5-3-2-1:1.9
	Release-5-3-2-1:1.9
	ROOT_RELEASE-5-3-2-1:1.9
	RELEASE-5-3-2-1:1.9.0.20
	Release-5-3-2:1.9.0.16
	Root_Release-5-3-2:1.9
	Root_Release-5-3-1:1.9
	Release-5-3-1:1.9.0.14
	Release-5-2-3-1:1.9.0.12
	Root_Release-5-2-3-1:1.9
	Release-5-2-2-4:1.9.0.10
	Root_Release-5-2-2-4:1.9
	Release-5-2-2-1:1.9.0.8
	Root_Release-5-2-2-1:1.9
	upstream_version_5_2_2:1.9
	debian_version_5_2_2-1:1.9
	Release-5-2-2:1.9.0.6
	ROOT_Release-5-2-2:1.9
	ROOT_Release-5-2-1:1.9
	Release-5-2-1:1.9.0.4
	Release-5-2-0:1.9.0.2
	ROOT_Release-5-2-0:1.9
	ROOT_Release-5-1-2:1.8
	Release-5-1-2:1.8.0.8
	Version-5-1-1:1.8.0.6
	ROOT_Version-5-1-1:1.8
	debian_version_5_1_0-1:1.8
	upstream_version_5_1_0:1.8
	ROOT_Release-5-1-0:1.8
	Release-5-1-0:1.8.0.4
	ROOT_Release-5-0-0:1.8
	Release-5-0-0:1.8.0.2
	Release-4-3-3:1.7.0.8
	ROOT_Release-4-3-3:1.7
	upstream_version_4_3_2:1.7
	debian_version_4_3_2-1:1.7
	ROOT_Release-4-3-2:1.7
	Release-4-3-2:1.7.0.6
	Release-4-3-1:1.7.0.4
	ROOT_Release-4-3-1:1.7
	debian_version_4_3_0-1:1.7
	upstream_version_4_3_0:1.7
	ROOT_Release-4-3-0:1.7
	Release-4-3-0:1.7.0.2
	debian_version_3_2_1b-2:1.5
	debian_version_4_2_2-1:1.6
	upstream_version_4_2_2:1.6
	debian_version_3_2_1b-1:1.5
	upstream_version_3_2_1b:1.5
	Release-4-1-2:1.6.0.8
	Release-4-0-8:1.6.0.6
	debian_version_4_0_8a-1:1.6
	upstream_version_4_0_8a:1.6
	jostb-debian-ubuntu-patch:1.6.0.4
	debian_version_4_0_8-1:1.6
	upstream_version_4_0_8:1.6
	debian_version_4_0_7-1:1.6
	upstream_version_4_0_7:1.6
	debian_version_4_0_6-1:1.6
	upstream_version_4_0_6:1.6
	debian_version_4_0_2-1:1.6
	upstream_version_4_0_2:1.6
	Release-4-0-2_Root:1.6
	Release-4-0-2:1.6.0.2
	upstream_version_4_0_1:1.6
	debian_version_4_0_1-2:1.6
	Release-3-2-1:1.5.0.2
	Release-3-1-8:1.4.0.2;
locks; strict;
comment	@# @;


1.11
date	2009.07.25.13.56.02;	author jost_boekemeier;	state Exp;
branches;
next	1.10;

1.10
date	2008.11.27.21.00.26;	author jost_boekemeier;	state Exp;
branches;
next	1.9;

1.9
date	2008.03.02.21.36.52;	author jost_boekemeier;	state Exp;
branches;
next	1.8;

1.8
date	2008.01.06.20.59.20;	author jost_boekemeier;	state Exp;
branches;
next	1.7;

1.7
date	2007.09.19.10.12.27;	author jost_boekemeier;	state Exp;
branches;
next	1.6;

1.6
date	2007.03.09.20.28.11;	author andremachado;	state Exp;
branches;
next	1.5;

1.5
date	2006.12.10.11.53.44;	author jost2345;	state Exp;
branches;
next	1.4;

1.4
date	2006.09.05.20.40.33;	author jost2345;	state Exp;
branches;
next	1.3;

1.3
date	2006.08.08.17.20.45;	author jost2345;	state Exp;
branches;
next	1.2;

1.2
date	2006.07.16.20.29.26;	author jost2345;	state Exp;
branches;
next	1.1;

1.1
date	2006.06.21.19.53.09;	author jost2345;	state Exp;
branches;
next	;


desc
@@


1.11
log
@Release-5-5
@
text
@<?php include_once ("java/Java.inc");

java_autoload("lucene.jar");

use java\lang\System as SYS;
use java\io as IO;
use java\util as Util;
use org\apache\lucene as Lucene;


try {
  echo "indexing ... ";
  /* create the index files in the tmp dir */
  $tmp = create_index_dir();
  $analyzer = new Lucene\analysis\standard\StandardAnalyzer();
  $writer = new Lucene\index\IndexWriter($tmp, $analyzer, true);
  $file = new IO\File(getcwd());
  $files = $file->listFiles();
  assert (!java_is_null($files));

  foreach($files as $f) {
    $doc = new Lucene\document\Document();
    $doc->add(new Lucene\document\Field(
	       "name", 
	       $f->getName(), 
	       Lucene\document\Field::type("Store")->YES, 
	       Lucene\document\Field::type("Index")->UN_TOKENIZED));
    $writer->addDocument($doc);
  }
  $writer->optimize();
  $writer->close();
  echo "done\n";

  echo "searching... ";
  /* Search */
  $searcher = new Lucene\search\IndexSearcher($tmp);
  $phrase = new Lucene\search\MatchAllDocsQuery();
  $hits = $searcher->search($phrase);

  /* Print result */
  $iter = $hits->iterator();
  $n = (int)(string)$hits->length();
  echo "done\n";
  echo "Hits: $n\n";

  /* Instead of retrieving the values one-by-one, we store them into a
   * LinkedList on the server side and then retrieve the list in one
   * query using java_values():
   */
  $resultList = new Util\LinkedList();

				// create an XML document from the
				// following PHP code, ...
  java_begin_document();
  while($n--) {
    $next = $iter->next();
    $name = $next->get("name");
    $resultList->add($name);
  }
				//  ... execute the XML document on
				//  the server side, ...
  java_end_document();
  
				// .. retrieve the result, ...
  $result = java_values($resultList); 
				// ... print the result array
  print_r($result);

  delete_index_dir();
} catch (JavaException $e) {
  echo "Exception occured: "; echo $e; echo "<br>\n";
}

/** helper functions */
$tmp_file=null;
$tmp_dir=null;
/** create a temporary directory for the lucene index files. Make sure
 * to create the tmpdir from Java so that the directory has
 * javabridge_tmp_t Security Enhanced Linux permission. Note that PHP
 * does not have access to tempfiles with java_bridge_tmp_t: PHP
 * inherits the rights from the HTTPD, usually httpd_tmp_t.
 */
function create_index_dir() {
  global $tmp_file, $tmp_dir;
  $javaTmpdir = SYS::type()->getProperty("java.io.tmpdir");
  $tmpdir = (string)$javaTmpdir;
  $tmp_file=tempnam($tmpdir, "idx");
  $tmp_dir=new IO\File("${tmp_file}.d");
  $tmp_dir->mkdir();
  return (string)$tmp_dir->toString();
}

/** delete the lucene index files */
function delete_index_dir() {
  global $tmp_file, $tmp_dir;
  $files = $tmp_dir->listFiles();
  foreach($files as $f) {
    $f->delete();
  }
  $tmp_dir->delete();
  unlink($tmp_file);
  $tmp_file=$tmp_dir=null;
}

?>
@


1.10
log
@Release 5.3.3.1
@
text
@d5 4
a8 4
use java::lang::System as SYS;
use java::io as IO;
use java::util as Util;
use org::apache::lucene as Lucene;
d15 3
a17 3
  $analyzer = new Lucene::analysis::standard::StandardAnalyzer();
  $writer = new Lucene::index::IndexWriter($tmp, $analyzer, true);
  $file = new IO::File(getcwd());
d22 2
a23 2
    $doc = new Lucene::document::Document();
    $doc->add(new Lucene::document::Field(
d26 2
a27 2
	       Lucene::document::Field::type("Store")->YES, 
	       Lucene::document::Field::type("Index")->UN_TOKENIZED));
d36 2
a37 2
  $searcher = new Lucene::search::IndexSearcher($tmp);
  $phrase = new Lucene::search::MatchAllDocsQuery();
d50 1
a50 1
  $resultList = new Util::LinkedList();
d88 1
a88 1
  $tmp_dir=new IO::File("${tmp_file}.d");
@


1.9
log
@Release-5-2-0
@
text
@d1 2
a2 2
<?php
require_once ("java/Java.inc");
d5 5
a12 2
  /* Create an index */
  $cwd=getcwd();
d15 3
a17 3
  $analyzer = new org_apache_lucene_analysis_standard_StandardAnalyzer();
  $writer = new org_apache_lucene_index_IndexWriter($tmp, $analyzer, true);
  $file = new java_io_File($cwd);
d19 2
a20 7
  if(is_null($files)) {
    $user = java_lang_System::type()->getProperty("user.name");
    echo("$cwd does not exist or is not readable.\n");
    echo("The directory must be readable by the user $user and it must not\n");
    echo("be protected by a SEL rule.\n");
    exit(1);
  }
d22 2
a23 2
    $doc = new org_apache_lucene_document_Document();
    $doc->add(new org_apache_lucene_document_Field(
d26 2
a27 2
	       org_apache_lucene_document_Field::type("Store")->YES, 
	       org_apache_lucene_document_Field::type("Index")->UN_TOKENIZED));
d36 2
a37 2
  $searcher = new org_apache_lucene_search_IndexSearcher($tmp);
  $phrase = new org_apache_lucene_search_MatchAllDocsQuery();
d42 1
a42 1
  $n = java_values($hits->length());
d50 1
a50 1
  $resultList = new java_util_LinkedList();
d85 2
a86 2
  $javaTmpdir = java_lang_System::type()->getProperty("java.io.tmpdir");
  $tmpdir = java_values($javaTmpdir);
d88 1
a88 1
  $tmp_dir=new java_io_File("${tmp_file}.d");
d90 1
a90 1
  return java_values($tmp_dir->toString());
@


1.8
log
@Release-5-0-0
@
text
@d2 1
a2 2
if(!extension_loaded("java"))
  require_once("http://localhost:8080/JavaBridge/java/Java.inc");
@


1.7
log
@Release-4-3-0
@
text
@d45 1
a45 1
  $n = $hits->length();
@


1.6
log
@Files update 3.2.2 to 4.0.1. Extracted from the src.tar.gz downloaded from sf.net, uploaded by Jost Boekemeier. Update to repository by Andre Felipe Machado.
@
text
@d2 4
a5 4
require_once('rt/java_io_File.php');
require_once('rt/java_lang_System.php');
require_once('rt/java_util_LinkedList.php');
require_once('lucene/All.php');
d18 1
a18 1
    $user = java_lang_System()->getProperty("user.name");
d29 2
a30 2
	       org_apache_lucene_document_Field__Store()->YES, 
	       org_apache_lucene_document_Field__Index()->UN_TOKENIZED));
d51 1
a51 1
   * query:
d57 1
a57 1
  java_lang_System::javaBeginDocument();
d65 1
a65 1
  java_lang_System::javaEndDocument();
d68 1
a68 1
  $result = java_lang_System::javaValues($resultList); 
d74 1
a74 1
  echo "Exception occured: {$e->__toString()}<br>\n";
d88 1
a88 1
  $javaTmpdir = java_lang_System()->getProperty("java.io.tmpdir");
@


1.5
log
@Release-3-2-1
@
text
@d4 1
d8 1
d35 1
d37 1
d40 1
a40 3
  $term=new org_apache_lucene_index_Term("name", "lucene_search.php");
  $phrase = new org_apache_lucene_search_PhraseQuery();
  $phrase->add($term);
d46 1
d49 10
a58 1
  while($iter->hasNext()) {
d61 1
a61 1
    echo java_cast($name, "string")."\n";
d63 9
@


1.4
log
@Release-3-1-8rc3
@
text
@d53 1
a53 1
  echo "Exception occured: $e<br>\n";
d67 3
a69 1
  $tmp_file=tempnam(java_lang_System()->getProperty("java.io.tmpdir"), "idx");
d72 1
a72 1
  return "{$tmp_dir->toString()}";
@


1.3
log
@Release-3-1-7
@
text
@d49 1
a49 1
    echo "$name\n";
d61 3
a63 3
 * javabridge_tmp_t permission. Note that PHP does not have access to
 * tempfiles with java_bridge_tmp_t: PHP inherits the rights from the
 * HTTPD, usually httpd_tmp_t.
@


1.2
log
@Release-3-1-6
@
text
@d6 27
a32 25
/* Create an index */
$cwd=getcwd();
/* create the index files in the tmp dir */
$tmp_dir = create_index_dir();
$analyzer = new org_apache_lucene_analysis_standard_StandardAnalyzer();
$writer = new org_apache_lucene_index_IndexWriter("$tmp_dir", $analyzer, true);
$file = new java_io_File($cwd);
$files = $file->listFiles();
if(is_null($files)) {
  $user = java_lang_System()->getProperty("user.name");
  echo("$cwd does not exist or is not readable.\n");
  echo("The directory must be readable by the user $user and it must not\n");
  echo("be protected by a SEL rule.\n");
  exit(1);
 }
foreach($files as $f) {
	$doc = new org_apache_lucene_document_Document();
	$doc->add(new org_apache_lucene_document_Field("name", 
                   $f->getName(), 
		   org_apache_lucene_document_Field__Store()->YES, 
                   org_apache_lucene_document_Field__Index()->UN_TOKENIZED));
	$writer->addDocument($doc);
}
$writer->optimize();
$writer->close();
d34 20
a53 16
/* Search */
$searcher = new org_apache_lucene_search_IndexSearcher("$tmp_dir");
$term=new org_apache_lucene_index_Term("name", "lucene_search.php");
$phrase = new org_apache_lucene_search_PhraseQuery();
$phrase->add($term);
$hits = $searcher->search($phrase);

/* Print result */
$iter = $hits->iterator();
$n = $hits->length();
echo "Hits: $n\n";

while($iter->hasNext()) {
  $next = $iter->next();
  $name = $next->get("name");
  echo "$name\n";
d59 6
a64 1
/** create a temporary directory for the lucene index files */
d68 3
a70 4
  $tmp_dir="${tmp_file}.d";
  mkdir($tmp_dir);
  chmod($tmp_dir, 01777);
  return $tmp_dir;
d75 4
a78 3
  $dir=opendir($tmp_dir);
  while($file=readdir($dir)) {
    unlink("${tmp_dir}/${file}");
d80 1
a80 1
  rmdir($tmp_dir);
@


1.1
log
@Release-3-1-2
@
text
@d3 1
d7 3
a9 1
$here=getcwd();
d11 11
a21 3
$writer = new org_apache_lucene_index_IndexWriter("$here", $analyzer, true);
$file = new java_io_File($here);
foreach($file->listFiles() as $f) {
d33 1
a33 1
$searcher = new org_apache_lucene_search_IndexSearcher("$here");
d49 25
@

