head	1.12;
access;
symbols
	Release-3-1-8:1.10.0.2
	Release-3-0-8_root:1.6.2.1
	Release-3-0-8_Root:1.9
	Release-3-0-8:1.6.0.2;
locks; strict;
comment	@# @;


1.12
date	2006.11.02.14.55.47;	author jost2345;	state dead;
branches;
next	1.11;

1.11
date	2006.11.02.14.51.46;	author jost2345;	state Exp;
branches;
next	1.10;

1.10
date	2006.07.23.20.32.47;	author jost2345;	state Exp;
branches;
next	1.9;

1.9
date	2006.04.28.18.15.02;	author jost2345;	state Exp;
branches;
next	1.8;

1.8
date	2006.04.26.19.09.31;	author jost2345;	state Exp;
branches;
next	1.7;

1.7
date	2006.04.12.17.46.46;	author jost2345;	state Exp;
branches;
next	1.6;

1.6
date	2006.03.21.18.11.02;	author jost2345;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2006.03.18.18.56.40;	author jost2345;	state Exp;
branches;
next	1.4;

1.4
date	2006.03.16.20.27.00;	author jost2345;	state Exp;
branches;
next	1.3;

1.3
date	2006.03.12.16.44.39;	author jost2345;	state Exp;
branches;
next	1.2;

1.2
date	2006.03.11.17.55.30;	author jost2345;	state Exp;
branches;
next	1.1;

1.1
date	2006.03.10.18.44.25;	author jost2345;	state Exp;
branches;
next	;

1.6.2.1
date	2006.04.23.19.09.08;	author jost2345;	state Exp;
branches;
next	1.6.2.2;

1.6.2.2
date	2006.05.13.16.09.57;	author jost2345;	state Exp;
branches;
next	;


desc
@@


1.12
log
@*** empty log message ***
@
text
@#!/bin/sh
# Installation script for the PHP/Java Bridge module and its back-ends.

#set -x
v=""
if test "X$1" = "X--verbose" || test "X$1" = "X-v" ; then
v="-v"
fi

if ! test -d modules; then
  echo "Nothing to install. Do a phpize && configure && make first, bye."
  exit 10
fi

php=`php-config --php-binary`
if test $? != 0; then php="`which php`"; fi
if test $? != 0; then php="`which php-cgi`"; fi
if test $? != 0; then 
 for i in /usr/bin/php /usr/bin/php-cgi /usr/local/bin/php /usr/local/bin/php-cgi; do
  if test -f $i; then php=$i; break; fi
 done
fi

if test X$php = X; then echo "php not installed, bye."; exit 3; fi

echo '<?php phpinfo();?>' | ${php} >/tmp/phpinfo.$$
ini=`fgrep "Scan this dir for additional" /tmp/phpinfo.$$ | head -1 |
sed 's/<[TtRr][/a-z ="0-9]*>/ => /g' | 
sed 's/<[/a-z ="0-9]*>//g' | 
sed 's/^.*=> //' | sed 's/ *$//; s/^ *//'`
ext=`fgrep extension_dir /tmp/phpinfo.$$ | head -1 |
sed 's/<[TtRr][/a-z ="0-9]*>/ => /g' | 
sed 's/<[/a-z ="0-9]*>//g' | 
sed 's/^.*=> //' | sed 's/ *$//; s/^ *//'`
phpini=`fgrep "Configuration File (php.ini) Path" /tmp/phpinfo.$$ | head -1 |
sed 's/<[TtRr][/a-z ="0-9]*>/ => /g' | 
sed 's/<[/a-z ="0-9]*>//g' | 
sed 's/^.*=> //' | sed 's/ *$//; s/^ *//'`
phpinc=`fgrep "include_path" /tmp/phpinfo.$$ | head -1 |
sed 's/<[TtRr][/a-z ="0-9]*>/ => /g' | 
sed 's/<[/a-z ="0-9]*>//g' | 
sed 's/^.*=> //' | sed 's/ *$//; s/^ *//' |
LANG=C awk '{for(i=1; i<=(split($0, ar, "[;:]")); i++) if(substr(ar[i], 1) != "." && substr(ar[i], 1) != "..") print ar[i] }' |
head -1`
/bin/rm -f /tmp/phpinfo.$$
if test -d $phpini; then phpini="${phpini}/php.ini"; fi

# install generic ini
make install >install.log || exit 1
mod_dir=`/bin/cat install.log | sed -n '/Installing shared extensions:/s///p' | awk '{print $1}'`
if test X$v != X; then echo "installed in $mod_dir"; fi

overwrite="no"
if test X$ini = X; then
echo ""
echo "This php installation does not have a config-file-scan-dir,"
echo "java.ini and java-servlet.ini not installed,"
echo "will use file $phpini instead."
if test -f ${phpini}; then
   echo -n "Overwrite existing php.ini file (yes/no): "; read overwrite;
else
   overwrite="yes"
fi
fi

if test -d "$ext"; then 
if test X$v != X; then echo "Using extension_dir: $ext"; fi
else
echo ""
echo "Warning: Your php installation is broken, the \"extension_dir\" does "
echo "not exist or is not a directory (see php.ini extension_dir setting)."
echo "Please correct this, for example type:"
echo "mkdir \"$ext\""
echo ""
fi

/bin/rm -f $ini 2>/dev/null
if test X$ini != X; then
 /bin/mkdir -p $ini
 /bin/cp $v java.ini $ini
else
  if test X$overwrite = "Xyes"; then
    if test -f $phpini; then
      /bin/rm $v -f "${phpini}.backup"
      /bin/mv $v "$phpini" "${phpini}.backup"
    fi
    echo "include_path=/usr/share/pear:." >"$phpini"
    /bin/cat java.ini >>"$phpini"
  fi
fi

if test 1 = 1; then
jre=modules/java
else
jre=java
sdk_home=/home/users/j/jo/jost2345/PHP-JAVA-BRIDGE-amd64/j2re1.4.2.amd64
 if ! $jre -classpath modules/JavaBridge.jar php.java.bridge.JavaBridge --version >/dev/null; then
    echo "Default JRE: $jre is not usuable."
    echo "You have configured against ${sdk_home} but the installed JRE is:"
    echo ""
    echo "  `$jre -version|head -5`"
    echo ""
    echo "Please configure as follows:"
    echo "  ./configure --with-java=$sdk_home,$sdk_home"
    echo "to avoid this warning -- the jre version must be >= the jdk version.";
    echo "Ignoring $jre and using ${sdk_home}/bin/java instead."
    jre=${sdk_home}/bin/java
    echo "Please either use the above ./configure command or add" 
    echo "  java.java=$jre"
    echo "to your php .ini file."
 fi
fi

# devel
/bin/rm $v -f /usr/share/java/JavaBridge.jar /usr/share/java/script-api.jar /usr/share/java/php-script.jar /usr/java/packages/lib/ext/JavaBridge.jar /usr/java/packages/lib/ext/php-script.jar
if test -f modules/php-script.jar; then
    echo ""
    echo "Do you want to install the development files for jdk1.6?";
    echo -n "install development files (yes/no): "; read devel;
    if test "X$devel" != "Xno"; then
	/bin/mkdir -p /usr/share/java 2>/dev/null

	/bin/cp $v modules/JavaBridge.jar \
	      modules/php-script.jar \
	      modules/script-api.jar /usr/share/java

	/bin/mkdir -p /usr/java/packages/lib/ext 2>/dev/null

	/bin/rm -f /usr/java/packages/lib/ext/JavaBridge.jar \
	      /usr/java/packages/lib/ext/php-script.jar 2>/dev/null

	/bin/ln $v -s /usr/share/java/JavaBridge.jar \
	         /usr/share/java/php-script.jar /usr/java/packages/lib/ext

	echo "Installed in /usr/share/java"
	echo ""
        echo "The development files have been installed on this computer."
	echo "Type (e.g.) /usr/java/jdk1.6.0/bin/jrunscript -l php-interactive"
	echo "to start an interactive php session."
	echo ""
      fi
fi

# convert Java -> PHP
if test X$phpinc = X; then phpinc="/usr/share/pear"; fi
echo "";
echo "Generate PHP classes from standard Java classes and install them in"
echo "the ${phpinc} directory?"
echo -n "convert java libraries (yes/no): "; read convert;
if ! test "X$convert" = "Xno"; then
$jre -Djava.library.path=./modules -Djava.class.path=./modules/JavaBridge.jar -Djava.awt.headless=true -Dphp.java.bridge.base=./modules php.java.bridge.JavaBridge --convert ${phpinc} unsupported/lucene.jar:unsupported/itext.jar
/bin/cp java/*.php ${phpinc}/java
echo ""
fi

check_document_root() {
    document_root="/var/www/html";
    if ! test -d /var/www/html; then
	document_root="/usr/local/var/www/html";
	echo ""
	echo "Enter the location of HTTP server document root (e.g.: /usr/local/htdocs)";
	echo -n "document root ($document_root): "; read document_root;
	if test X$document_root = X; then document_root="/usr/local/var/www/html";fi
	echo ""
	if ! test -d $document_root; then echo "$document_root is not directory"; exit 5; fi
    fi
}

install_sel_module() {
 (
	cd security/module; 
	/usr/bin/make; 
	/usr/sbin/semodule -i php-java-bridge.pp
	/usr/bin/chcon -t javabridge_exec_t $ext/RunJavaBridge
	/usr/bin/chcon -t bin_t $ext/java
	if test X$javabridgeservice != X; then /usr/bin/chcon -t initrc_exec_t $javabridgeservice; fi
 )
}

j2ee=no
# j2ee/servlet
/bin/rm $v -f ${ini}/java-servlet.ini 2>/dev/null
if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then 
    /usr/sbin/semodule -r javabridge 2>/dev/null
    /usr/sbin/semodule -r javabridge_tomcat 2>/dev/null
fi
if test -f modules/JavaBridge.war; then
    echo ""
    echo "Do you want to start the Servlet/J2EE back-end as a service?";
    echo "Say no, if you want to start the service automatically with Apache."
    echo "If unsure, say no";
    echo -n "install j2ee back-end (yes/no): "; read j2ee;
    if test "X$j2ee" != "Xno"; then
      webapps="`locate /webapps | fgrep tomcat | grep 'webapps$' | head -1`"
      echo ""
      echo "Enter the location of the autodeploy folder (e.g.: /opt/tomcat/webapps):";
      echo -n "autodeploy ($webapps): "; read webapps2;
      if test X$webapps2 != X; then webapps=$webapps2; fi
      /bin/rm $v -rf ${webapps}/JavaBridge.war ${webapps}/JavaBridge
      /bin/cp $v modules/JavaBridge.war $webapps;
      echo "Installed in $webapps.";
      check_document_root || exit 5
      if test -d ${document_root} && ! test -e ${document_root}/JavaBridge; then
        ln -s $webapps/JavaBridge ${document_root}/;
        echo "Installed in ${document_root}. "
      fi
      if test X$ini != X; then  
	  /bin/cp $v java-servlet.ini $ini; 
      else
	  if test X$overwrite = "Xyes"; then
	      /bin/cat java-servlet.ini >>"$phpini"; 
	  fi
      fi
      if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then 
        if test X$v = X; then
            install_sel_module >/dev/null
	    (cd security/module; /usr/bin/make; /usr/sbin/semodule -i php-java-bridge-tomcat.pp) >/dev/null
	else
            install_sel_module;
	    (cd security/module; /usr/bin/make; /usr/sbin/semodule -i php-java-bridge-tomcat.pp) 
	fi
      fi
      echo ""
      echo "The J2EE back-end has been desployed into the J2EE server. Now start the J2EE"
      echo "server and the web server, for example with the commands (Linux):"
      echo ""
      echo "    service tomcat5 restart"
      echo "    service httpd restart"
      echo ""
      echo " or (Unix):"
      echo ""
      echo "    JAVA_HOME=$sdk_home `dirname $webapps`/bin/catalina.sh stop"
      echo "    JAVA_HOME=$sdk_home `dirname $webapps`/bin/catalina.sh start"
      echo "    apachectl restart"
      echo ""
     
      echo "Browse to http://localhost:<PORT>/JavaBridge to see the test page from the"
      echo "J2EE server. PORT is 8080 for tomcat, 9080 for WebSphere and 8888 for Oracle."
      echo "Browse to http://localhost/JavaBridge to see the test page from the web server."
      echo ""
    fi
else
    install_sel_module;
fi

echo "PHP/Java Bridge installed."
if test -d /etc/selinux; then
if /usr/sbin/selinuxenabled; then
  if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then
    echo "SEL Security: \"javabridge\" policy module installed."
  fi
else
  echo "You are running a SELinx system. Please install the policy sources"
  echo "or install the files from the RPM distribution download."
  echo "Please see the README document for details".
fi
fi

echo ""
echo "Now type \"${php} test.php\" to check the installation."
echo ""

exit 0
@


1.11
log
@*** empty log message ***
@
text
@@


1.10
log
@Release-3-1-6
@
text
@d46 1
d57 1
a57 1
echo "java.ini, java-standalone.ini and java-servlet.ini not installed,"
d61 2
d83 6
a88 3
    /bin/rm $v -f "${phpini}.backup"
    /bin/mv $v "$phpini" "${phpini}.backup"
    /bin/cat java.ini >"$phpini"
d92 1
a92 1
if test 0 = 1; then
d151 2
a152 1
$jre -Djava.library.path=./modules -Djava.class.path=./modules/JavaBridge.jar -Djava.awt.headless=true -Dphp.java.bridge.base=./modules php.java.bridge.JavaBridge --convert ${phpinc} unsupported/lucene.jar
d169 11
d183 4
a189 3
    echo "This is the fastest and easiest service, only RedHat Enterprise"
    echo "or Fedora Linux users should say no here."
    echo "Say no, if you want to enable Security Enhanced Linux."
d216 1
d219 1
a241 93
fi


# standalone
/bin/rm $v -f ${ini}/java-standalone.ini 2>/dev/null
for i in /etc/init.d /etc/rc.d/init.d /etc/rc.d; do
    if test -f ${i}/php-java-bridge; then
	/bin/rm $v -f ${i}/php-java-bridge
	break;
    fi
done
install_sel_module() {
 (
	cd security/module; 
	/usr/bin/make; 
	/usr/sbin/semodule -i php-java-bridge.pp
	/usr/bin/chcon -t javabridge_exec_t $ext/RunJavaBridge
	/usr/bin/chcon -t sbin_t /usr/sbin/php-java-bridge
	if test X$javabridgeservice != X; then /usr/bin/chcon -t initrc_exec_t $javabridgeservice; fi
 )
}
if test -f modules/JavaBridge.jar && test "X$j2ee" = "Xno"; then
    echo ""
    echo "Do you want to start the standalone back-end from a service script?"
    echo "Non- RedHat Enterprise or Fedora Linux users probably want to say no here.";
    echo "Say no, if you want to start the service automatically with Apache."
    echo "Say no, if this operating system doesn't support SysV service scripts."
    echo "Say yes, if you want to enable Security Enhanced Linux."
    echo "If unsure, say no";
    echo -n "install service script (yes/no): "; read standalone;
    if test "X$standalone" = "Xyes"; then
	/bin/cp $v php-java-bridge /usr/sbin
	/bin/chmod +x /usr/sbin/php-java-bridge
	if test X$v != X; then echo "Installed /usr/sbin/php-java-bridge"; fi
	for i in /etc/init.d /etc/rc.d/init.d /etc/rc.d; do
	if test -d $i; then
	    /bin/cp $v php-java-bridge.service ${i}/php-java-bridge
	    /bin/chmod +x ${i}/php-java-bridge
	    javabridgeservice=${i}/php-java-bridge # used in install_sel_module
	    if test X$v != X; then echo "Installed service ${i}/php-java-bridge"; fi
	    break;
	fi
	done
	/sbin/chkconfig --add php-java-bridge &&
	/sbin/chkconfig php-java-bridge on
        echo -n "run the back-end with limited rights (yes/no): "; read limited;
        if test "X$limited" = "Xyes"; then
          echo -n "run the back-end as user (default: apache): "; read user;
	  if test X$user = X; then user="apache"; fi
          echo -n "run the back-end as group (default: apache): "; read group;
	  if test X$group = X; then group=$user; fi
          (/bin/chown $user:$group $ext/RunJavaBridge &&
           /bin/chmod 6111 $ext/RunJavaBridge) || /bin/rm -f $ext/RunJavaBridge
        else
	   /bin/chmod 111 $ext/RunJavaBridge || /bin/rm -f $ext/RunJavaBridge
        fi
	if test X$ini != X; then 
	    /bin/cat java-standalone.ini | sed 's|^;java\.java_home[\t =].*$|;java.java_home = |; s|^;java\.java[\t =].*$|java.java = '$jre'|' >${ini}/java-standalone.ini
	    if test X$v != X; then echo "Installed ${ini}/java-standalone.ini"; fi
	    
        else
           if test X$overwrite = "Xyes"; then
	       /bin/cat java-standalone.ini | sed 's|^;java\.java_home[\t =].*$|;java.java_home = |; s|^;java\.java[\t =].*$|java.java = '$jre'|' >"$phpini"
	   fi
	fi
	check_document_root || exit 5;
	if test -d ${document_root} && ! test -e ${document_root}/test.php; then
          /bin/cp $v test.php ${document_root}/test.php
	  if test X$v != X; then echo "Installed ${document_root}/test.php."; fi
	fi
        echo -n "start now? (yes/no): "; read restart;
	if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then 
          if test X$v = X; then
	    install_sel_module >/dev/null
	  else
	    install_sel_module
	  fi
        fi
        if test "X${restart}" != "Xno"; then
            /sbin/service php-java-bridge restart
            /sbin/service httpd restart
        fi
	echo ""
	echo "The php-java-bridge service has been installed. It can be started with:"
	echo ""
	echo "    service php-java-bridge restart"
	echo "    service httpd restart"
	echo ""
        echo "Browse to http://localhost/test.php to see the test page."
	echo ""
    else
	/bin/rm $v -f /usr/sbin/php-java-bridge $ext/RunJavaBridge
    fi
d243 1
a243 1
    /bin/rm $v -f /usr/sbin/php-java-bridge $ext/RunJavaBridge
@


1.9
log
@Release-3-1-0
@
text
@d2 1
a2 1
# Installation script for the PHP/Java Bridge module and its backends.
d26 1
a26 1
echo "<?php phpinfo();?>" | ${php} 2>/dev/null >/tmp/phpinfo.$$
d30 1
a30 1
sed 's/^.*=> //'`
d34 11
a44 1
sed 's/^.*=> //'`
d49 1
a49 1
mod_dir=`cat install.log | sed -n '/Installing shared extensions:/s///p' | awk '{print $1}'`
d52 1
d56 5
a60 2
echo "java.ini, java-standalone.ini and java-servlet.ini not installed."
echo "You must edit the php.ini yourself."
d78 6
d86 76
d167 7
a173 2
    echo "Do you want to install the Servlet/J2EE backend (recommended)?";
    echo -n "install j2ee backend (yes/no): "; read j2ee;
d177 1
a177 1
      echo "Enter the location of the autodeploy folder.";
d180 1
d182 12
a193 7
      echo "Installed in $webapps."
      echo ""
      echo "Restart your J2EE server (e.g. with: service tomcat5 restart) and visit e.g.:"
      echo "http://localhost:8080/JavaBridge"
      if test -d /var/www/html && ! test -e /var/www/html/JavaBridge; then
        ln -s $webapps/JavaBridge /var/www/html/;
        echo "Installed in /var/www/html. "
d195 2
a196 5
      echo "Restart your HTTP server (e.g. with: service httpd restart) and visit e.g.:"
      echo "http://localhost/JavaBridge";
      if test X$ini != X; then  /bin/cp $v java-servlet.ini $ini; fi
	if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then 
          if test X$v = X; then
d198 1
a198 1
	  else
a199 1
	  fi
d201 19
d223 1
d233 1
a233 1
(
d240 1
a240 1
)
a241 1
/bin/rm $v -f /usr/sbin/php-java-bridge
d244 7
a250 2
    echo "Do you want to install the standalone backend (deprecated)?";
    echo -n "install standalone backend (yes/no): "; read standalone;
d266 11
a276 2
	(/bin/chown apache:apache $ext/RunJavaBridge &&
	/bin/chmod 6111 $ext/RunJavaBridge) || /bin/rm -f $ext/RunJavaBridge
a277 5
	    jre="`locate /bin/java | grep 'java$' | head -1`"
	    echo ""
	    echo "Enter the location of the "java" jre binary.";
	    echo -n "java executable ($jre): "; read jre2;
	    if test X$jre2 != X; then jre=$jre2; fi
d281 4
d286 4
a289 3
	if test -d /var/www/html && ! test -e /var/www/html/test.php; then
          /bin/cp $v test.php /var/www/html/test.php
	  if test X$v != X; then echo "Installed /var/www/html/test.php."; fi
d291 1
a291 5
	echo ""
	echo "Restart the php-java-bridge service "
	echo "(e.g. with: service php-java-bridge restart) and and your HTTP server"
	echo "(e.g. with: service httpd restart) and visit e.g.:"
	echo "http://localhost/test.php"
d299 14
d314 2
a317 29
# devel
/bin/rm $v -f /usr/share/java/JavaBridge.jar /usr/share/java/script-api.jar /usr/share/java/php-script.jar /usr/java/packages/lib/ext/JavaBridge.jar /usr/java/packages/lib/ext/php-script.jar
if test -f modules/php-script.jar; then
    echo ""
    echo "Do you want to install the development files (recommended)?";
    echo -n "install development files (yes/no): "; read devel;
    if test "X$devel" != "Xno"; then
	/bin/mkdir -p /usr/share/java 2>/dev/null

	/bin/cp $v modules/JavaBridge.jar \
	      modules/php-script.jar \
	      modules/script-api.jar /usr/share/java

	/bin/mkdir -p /usr/java/packages/lib/ext 2>/dev/null

	/bin/rm -f /usr/java/packages/lib/ext/JavaBridge.jar \
	      /usr/java/packages/lib/ext/php-script.jar 2>/dev/null

	/bin/ln $v -s /usr/share/java/JavaBridge.jar \
	         /usr/share/java/php-script.jar /usr/java/packages/lib/ext

	echo "Installed in /usr/share/java"
	echo ""
	echo "Type (e.g.) /usr/java/jdk1.6.0/bin/jrunscript -l php-interactive"
	echo "to run php from java."
      fi
fi

echo ""
d330 5
@


1.8
log
@Release-3-1-0
@
text
@d91 1
d97 1
@


1.7
log
@Release-3.0.8
@
text
@d135 1
a135 1
	/sbin/chkconfig --add php-java-bridge
d137 2
a138 2
	/bin/chown apache:apache $ext/RunJavaBridge
	/bin/chmod 6111 $ext/RunJavaBridge
d198 2
a199 1
if test -d /etc/selinux && /usr/sbin/selinuxenabled; then
d208 1
@


1.6
log
@Release-3.0.8rc
@
text
@d2 1
d11 1
a11 1
  echo "Nothing to install."
d40 1
a40 1
echo "installed in $mod_dir";
d50 1
a50 1
echo "Using extension_dir: $ext"
d80 10
a89 1
      echo "installed in $webapps"
d91 5
d107 10
d124 2
a125 1
	chmod +x /usr/sbin/php-java-bridge
d129 3
a131 1
	    chmod +x ${i}/php-java-bridge
d137 2
a138 1
	echo "installed in /usr/sbin"
d145 2
a146 2
	    cat java-standalone.ini | sed 's|^;java\.java_home[\t =].*$|;java.java_home = |; s|^;java\.java[\t =].*$|java.java = '$jre'|' >${ini}/java-standalone.ini
	    echo "installed in $ini"
d149 16
d189 2
a190 1
	echo "installed in /usr/share/java"
d197 1
a197 1
echo "PHP/Java Bridge installed"
d199 7
a205 3
echo "You are running a SELinx system. Please install the policy sources"
echo "or install the files from the RPM distribution download."
echo "Please see the README document for details".
@


1.6.2.1
log
@Release-3-0-8-1
@
text
@a1 1
# Installation script for the PHP/Java Bridge module and its backends.
d10 1
a10 1
  echo "Nothing to install. Do a phpize && configure && make first, bye."
d39 1
a39 1
if test X$v != X; then echo "installed in $mod_dir"; fi
d49 1
a49 1
if test X$v != X; then echo "Using extension_dir: $ext"; fi
d79 1
a79 10
      echo "Installed in $webapps."
      echo ""
      echo "Restart your J2EE server (e.g. with: service tomcat5 restart) and visit e.g.:"
      echo "http://localhost:8080/JavaBridge"
      if test -d /var/www/html && ! test -e /var/www/html/JavaBridge; then
        ln -s $webapps/JavaBridge /var/www/html/;
        echo "Installed in /var/www/html. "
      fi
      echo "Restart your HTTP server (e.g. with: service httpd restart) and visit e.g.:"
      echo "http://localhost/JavaBridge";
a80 5
          if test X$v = X; then
	    (cd security/module; /usr/bin/make; /usr/sbin/semodule -i php-java-bridge-tomcat.pp) >/dev/null
	  else
	    (cd security/module; /usr/bin/make; /usr/sbin/semodule -i php-java-bridge-tomcat.pp) 
	  fi
a91 10
install_sel_module() {
(
	cd security/module; 
	/usr/bin/make; 
	/usr/sbin/semodule -i php-java-bridge.pp
	/usr/bin/chcon -t javabridge_exec_t $ext/RunJavaBridge
	/usr/bin/chcon -t sbin_t /usr/sbin/php-java-bridge
	if test X$javabridgeservice != X; then /usr/bin/chcon -t initrc_exec_t $javabridgeservice; fi
)
}
d99 1
a99 2
	/bin/chmod +x /usr/sbin/php-java-bridge
	if test X$v != X; then echo "Installed /usr/sbin/php-java-bridge"; fi
d103 1
a103 3
	    /bin/chmod +x ${i}/php-java-bridge
	    javabridgeservice=${i}/php-java-bridge # used in install_sel_module
	    if test X$v != X; then echo "Installed service ${i}/php-java-bridge"; fi
d107 1
a107 1
	/sbin/chkconfig --add php-java-bridge &&
d109 1
a109 2
	(/bin/chown apache:apache $ext/RunJavaBridge &&
	/bin/chmod 6111 $ext/RunJavaBridge) || /bin/rm -f $ext/RunJavaBridge
d116 2
a117 2
	    /bin/cat java-standalone.ini | sed 's|^;java\.java_home[\t =].*$|;java.java_home = |; s|^;java\.java[\t =].*$|java.java = '$jre'|' >${ini}/java-standalone.ini
	    if test X$v != X; then echo "Installed ${ini}/java-standalone.ini"; fi
a119 16
	if test -d /var/www/html && ! test -e /var/www/html/test.php; then
          /bin/cp $v test.php /var/www/html/test.php
	  if test X$v != X; then echo "Installed /var/www/html/test.php."; fi
	fi
	echo ""
	echo "Restart the php-java-bridge service "
	echo "(e.g. with: service php-java-bridge restart) and and your HTTP server"
	echo "(e.g. with: service httpd restart) and visit e.g.:"
	echo "http://localhost/test.php"
	if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then 
          if test X$v = X; then
	    install_sel_module >/dev/null
	  else
	    install_sel_module
	  fi
        fi
d144 1
a144 2
	echo "Installed in /usr/share/java"
	echo ""
d151 5
a155 11
echo "PHP/Java Bridge installed."
if test -d /etc/selinux; then
if /usr/sbin/selinuxenabled; then
  if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then
    echo "SEL Security: \"javabridge\" policy module installed."
  fi
else
  echo "You are running a SELinx system. Please install the policy sources"
  echo "or install the files from the RPM distribution download."
  echo "Please see the README document for details".
fi
@


1.6.2.2
log
@Release-3-0-8-1
@
text
@a90 1
	if test -f /etc/selinux/config && test -f /usr/sbin/semodule; then 
a95 1
	fi
@


1.5
log
@Release-3.0.8test1
@
text
@d9 5
d86 7
d124 1
@


1.4
log
@Release-3.0.8test1
@
text
@d10 3
a12 1
if test $?; then 
@


1.3
log
@Release-3.0.8pre2
@
text
@d9 10
a18 1
echo "<?php phpinfo();?>" | php 2>/dev/null >/tmp/phpinfo.$$
d23 4
d30 4
a33 1
make install || exit 1
d38 12
a49 2
echo "You must edit the php.ini yourself, bye."
exit 0
d53 4
a56 3
/bin/mkdir -p $ini
/bin/cp $v java.ini $ini

d58 1
d60 1
d66 1
a66 1
      webapps="`locate /webapps | head -1`"
d73 1
a73 2
      /bin/rm $v -f ${ini}/java-standalone.ini 2>/dev/null
      /bin/cp $v java-servlet.ini $ini
d78 1
d96 10
a105 2
	/bin/rm $v -f ${ini}/java-servlet.ini 2>/dev/null
	/bin/cp $v java-standalone.ini $ini
@


1.2
log
@Release-3.0.8pre2
@
text
@d20 3
a22 6
echo "This php installation does not support a config file directory,"
echo "this script cannot install java.ini, java-standalone.ini and"
echo "java-servlet.ini. You must edit your php.ini yourself."
echo "To fix this, configure php with: --with-config-file-scan-dir=<dir>"
echo "Please see the RedHat Linux php RPM or the FreeBSD 6 php PORT for"
echo "an example, bye."
d26 1
a26 1
/bin/rm -f $ini
@


1.1
log
@Release-3.0.8pre2
@
text
@d14 1
a14 1
rm -f /tmp/phpinfo.$$
d17 16
a32 2
make install
cp $v java.ini $ini
d43 1
a43 1
      echo -n "autodeploy ($webapps): "; read $webapps2;
d45 1
a45 1
      cp $v modules/JavaBridge.war $webapps;
d47 2
a48 1
      cp $v java-servlet.ini $ini
d57 2
a58 2
    if test "X$standalone" == "Xyes"; then
	cp $v php-java-bridge /usr/sbin
d60 7
a66 1
	cp $v php-java-bridge.service /etc/init.d/php-java-bridge
d70 2
a71 1
	cp $v java-standalone.ini $ini
d81 3
a83 1
	cp $v modules/JavaBridge.jar \
d87 1
a87 1
	mkdir -p /usr/java/packages/lib/ext 2>/dev/null
d89 2
a90 2
	rm -f /usr/java/packages/lib/ext/JavaBridge.jar \
	      /usr/java/packages/lib/ext/php-script.jar
d92 1
a92 1
	ln $v -s /usr/share/java/JavaBridge.jar \
d96 1
a96 1
	echo "Type /usr/java/jdk1.6.0/bin/jrunscript -l php-interactive"
d108 1
@

