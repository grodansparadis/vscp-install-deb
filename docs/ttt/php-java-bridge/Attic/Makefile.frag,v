head	1.23;
access;
symbols
	Release-5-5-4-1:1.22.0.26
	Root_Release-5-5-4-1:1.22
	Release-5-5-4:1.22.0.24
	Root_Release-5-5-4:1.22
	Release-5-5-3:1.22.0.22
	ROOT_Release-5-5-3:1.22
	Release-5-5-2:1.22.0.20
	Root_Release-5-5-2:1.22
	debian_version_5_5_1-1:1.22
	Release-5-5-1:1.22.0.16
	upstream_version_5_5_1:1.22
	ROOT_Release-5-5-1:1.22
	debian_version_5_5-1:1.22
	upstream_version_5_5:1.22
	ROOT_Release-5-5:1.22
	Release-5-5:1.22.0.18
	debian_version_5_4_4_2-3:1.22
	Release-5-4-4-2-1:1.22.0.12
	debian_version_5_4_4_2-2:1.22
	debian_version_5_4_4_2-1:1.22
	upstream_version_5_4_4_2:1.22
	debian_version_5_4_4_1-1:1.22
	upstream_version_5_4_4_1:1.22
	debian_version_5_4_4-1:1.22
	upstream_version_5_4_4:1.22
	Release-5-4-4:1.22.0.14
	Root_Release-5-4-4:1.22
	debian_version_5_4_3_2-1:1.22
	upstream_version_5_4_3_2:1.22
	Release_5-4-3-2:1.22.0.10
	Root_Release_5-4-3-2:1.22
	upstream_version_5_4_3_1:1.22
	debian_version_5_4_3_1-1:1.22
	Release-5-4-3:1.22.0.8
	Root_Release-5-4-3:1.22
	Root_Release-5-4-1:1.22
	Release-5-4-1:1.22.0.6
	Root_Release-5-4:1.22
	Release-5-4:1.22.0.4
	upstream_version_5_3_4:1.22
	debian_version_5_3_4-1:1.22
	ROOT_Release-5-3-4:1.22
	Release-5-3-4:1.22.0.2
	ROOT_Release-5-3-3:1.21
	Release-5-3-3:1.21.0.28
	debian_version_5_3_2_1_2-1:1.21
	upstream_version_5_3_2_1_2:1.21
	debian_version_5_3_2_1_1-1:1.21
	debian_version_5_3_2_1_1:1.21
	upstream_version_5_3_2_1_1:1.21
	Root_Release-5-3-2-1:1.21
	Release-5-3-2-1:1.21
	ROOT_RELEASE-5-3-2-1:1.21
	RELEASE-5-3-2-1:1.21.0.30
	Release-5-3-2:1.21.0.26
	Root_Release-5-3-2:1.21
	Root_Release-5-3-1:1.21
	Release-5-3-1:1.21.0.24
	Release-5-2-3-1:1.21.0.22
	Root_Release-5-2-3-1:1.21
	Release-5-2-2-4:1.21.0.20
	Root_Release-5-2-2-4:1.21
	Release-5-2-2-1:1.21.0.18
	Root_Release-5-2-2-1:1.21
	upstream_version_5_2_2:1.21
	debian_version_5_2_2-1:1.21
	Release-5-2-2:1.21.0.16
	ROOT_Release-5-2-2:1.21
	ROOT_Release-5-2-1:1.21
	Release-5-2-1:1.21.0.14
	Release-5-2-0:1.21.0.12
	ROOT_Release-5-2-0:1.21
	ROOT_Release-5-1-2:1.21
	Release-5-1-2:1.21.0.10
	Version-5-1-1:1.21.0.8
	ROOT_Version-5-1-1:1.21
	debian_version_5_1_0-1:1.21
	upstream_version_5_1_0:1.21
	ROOT_Release-5-1-0:1.21
	Release-5-1-0:1.21.0.6
	ROOT_Release-5-0-0:1.21
	Release-5-0-0:1.21.0.4
	Release-4-3-3:1.21.0.2
	ROOT_Release-4-3-3:1.21
	upstream_version_4_3_2:1.20
	debian_version_4_3_2-1:1.20
	ROOT_Release-4-3-2:1.20
	Release-4-3-2:1.20.0.6
	Release-4-3-1:1.20.0.4
	ROOT_Release-4-3-1:1.20
	debian_version_4_3_0-1:1.20
	upstream_version_4_3_0:1.20
	ROOT_Release-4-3-0:1.20
	Release-4-3-0:1.20.0.2
	debian_version_3_2_1b-2:1.17
	debian_version_4_2_2-1:1.19
	upstream_version_4_2_2:1.19
	debian_version_3_2_1b-1:1.17
	upstream_version_3_2_1b:1.17
	Release-4-1-2:1.17.0.12
	Release-4-0-8:1.17.0.10
	debian_version_4_0_8a-1:1.17
	upstream_version_4_0_8a:1.17
	jostb-debian-ubuntu-patch:1.17.0.8
	debian_version_4_0_8-1:1.17
	upstream_version_4_0_8:1.17
	debian_version_4_0_7-1:1.17
	upstream_version_4_0_7:1.17
	debian_version_4_0_6-1:1.17
	upstream_version_4_0_6:1.17
	debian_version_4_0_2-1:1.17
	upstream_version_4_0_2:1.17
	Release-4-0-2_Root:1.17
	Release-4-0-2:1.17.0.6
	upstream_version_4_0_1:1.17
	debian_version_4_0_1-2:1.17
	Release-3-2-1:1.17.0.4
	Release-3-1-8:1.17.0.2
	Release-3-0-8_root:1.16
	Release-3-0-8_Root:1.16
	Release-3-0-8:1.16.0.6
	Release-2-0-8:1.16.0.8
	Release-2-0-7_Root:1.16
	Release-2-0-7:1.16.0.4
	Release-2-0-6-branch:1.16.0.2
	Version-1:1.13.0.6
	Version-2:1.13.0.4
	Release-2:1.13.0.2
	PHP-5:1.6.0.4
	Release-1-0-6:1.8.0.2
	sparc-64-test:1.3.0.2
	V-2004-08-28:1.1.1.1
	PHP-JAVA-BRIDGE:1.1.1;
locks; strict;
comment	@# @;
expand	@k@;


1.23
date	2010.02.18.17.25.32;	author jost_boekemeier;	state dead;
branches;
next	1.22;

1.22
date	2008.11.27.21.00.26;	author jost_boekemeier;	state Exp;
branches;
next	1.21;

1.21
date	2007.12.28.13.56.41;	author jost_boekemeier;	state Exp;
branches;
next	1.20;

1.20
date	2007.09.30.16.07.52;	author jost_boekemeier;	state Exp;
branches;
next	1.19;

1.19
date	2007.07.19.16.19.15;	author jost_boekemeier;	state Exp;
branches;
next	1.18;

1.18
date	2007.07.09.14.35.06;	author jost_boekemeier;	state Exp;
branches;
next	1.17;

1.17
date	2006.06.19.20.37.14;	author jost2345;	state Exp;
branches;
next	1.16;

1.16
date	2005.04.18.18.37.56;	author jost2345;	state Exp;
branches;
next	1.15;

1.15
date	2005.04.18.18.21.43;	author jost2345;	state Exp;
branches;
next	1.14;

1.14
date	2005.04.18.16.58.48;	author jost2345;	state Exp;
branches;
next	1.13;

1.13
date	2005.02.03.16.56.07;	author jost2345;	state Exp;
branches;
next	1.12;

1.12
date	2005.01.28.16.32.52;	author jost2345;	state Exp;
branches;
next	1.11;

1.11
date	2004.12.20.20.04.42;	author jost2345;	state Exp;
branches;
next	1.10;

1.10
date	2004.12.12.09.57.25;	author jost2345;	state Exp;
branches;
next	1.9;

1.9
date	2004.12.03.18.35.21;	author jost2345;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.28.21.02.01;	author jost2345;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.28.20.51.44;	author jost2345;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.23.15.57.36;	author jost2345;	state Exp;
branches;
next	1.5;

1.5
date	2004.10.20.18.54.54;	author jost2345;	state Exp;
branches;
next	1.4;

1.4
date	2004.10.20.16.16.09;	author jost2345;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.06.16.37.58;	author jost2345;	state Exp;
branches;
next	1.2;

1.2
date	2004.10.04.16.24.20;	author jost2345;	state Exp;
branches;
next	1.1;

1.1
date	2004.08.28.06.05.55;	author jost2345;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.08.28.06.05.55;	author jost2345;	state Exp;
branches;
next	;


desc
@@


1.23
log
@Release-6-0-0
@
text
@# -*- mode: Makefile; -*-

$(phplibdir)/stamp:
	cd $(srcdir)/server; $(MAKE) CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) `echo $(CFLAGS_CLEAN)|sed 's/-D[^ ]*//g'`" install
@


1.22
log
@Release 5.3.3.1
@
text
@@


1.21
log
@Release-4-3-3
@
text
@a2 26
$(srcdir)/java_inc.c: $(srcdir)/Java.inc
	echo -n 'char java_inc[]="' >$(srcdir)/java_inc.c
	cat $(srcdir)/Java.inc | sed 's/\\/\\\\/g;s/"/\\"/g;s/.*/&\\n\\/'  >>$(srcdir)/java_inc.c
	echo '";' >>$(srcdir)/java_inc.c
	echo '#include <stddef.h>' >>$(srcdir)/java_inc.c
	echo 'size_t java_inc_length() {return sizeof(java_inc);}' >>$(srcdir)/java_inc.c


$(srcdir)/JavaRaw.inc:
	cat $(srcdir)/server/META-INF/java/JavaBridge.inc $(srcdir)/server/META-INF/java/Options.inc $(srcdir)/server/META-INF/java/Client.inc $(srcdir)/server/META-INF/java/GlobalRef.inc $(srcdir)/server/META-INF/java/NativeParser.inc $(srcdir)/server/META-INF/java/Parser.inc $(srcdir)/server/META-INF/java/Protocol.inc $(srcdir)/server/META-INF/java/SimpleParser.inc $(srcdir)/server/META-INF/java/JavaProxy.inc | sed -f $(srcdir)/server/extract.sed | sed '/^\/\*/,/\*\/$$/d' >$(srcdir)/JavaRaw.inc

$(srcdir)/Java.inc: $(srcdir)/JavaRaw.inc
	cat $(srcdir)/JavaRaw.inc | sed '/do not delete this line/d' >$(srcdir)/Java.inc

$(srcdir)/mono_inc.c: $(srcdir)/Mono.inc
	echo -n 'char mono_inc[]="' >$(srcdir)/mono_inc.c
	cat $(srcdir)/Mono.inc | sed 's/\\/\\\\/g;s/"/\\"/g;s/.*/&\\n\\/'  >>$(srcdir)/mono_inc.c
	echo '";' >>$(srcdir)/mono_inc.c
	echo '#include <stddef.h>' >>$(srcdir)/mono_inc.c
	echo 'size_t mono_inc_length() {return sizeof(mono_inc);}' >>$(srcdir)/mono_inc.c


$(srcdir)/Mono.inc: $(srcdir)/JavaRaw.inc
	cat $(srcdir)/JavaRaw.inc | sed -f $(srcdir)/server/append.sed | sed 's/JAVA/MONO/g;s/java/mono/g;s/Java/Mono/g;s/updateJarLibraryPath/updateLibraryPath/;s/^.*do not delete this line.*$$/$$name="cli.".$$name;/;' >$(srcdir)/Mono.inc


@


1.20
log
@Release-4-3-0
@
text
@d26 1
a26 1
	cat $(srcdir)/JavaRaw.inc | sed 's/JAVA/MONO/g;s/java/mono/g;s/Java/Mono/g;s/updateJarLibraryPath/updateLibraryPath/;s/^.*do not delete this line.*$$/$$name="cli.".$$name;/;' >$(srcdir)/Mono.inc
@


1.19
log
@Release-4-2-0
@
text
@d3 1
a3 1
$(srcdir)/java_inc.c: $(srcdir)/server/META-INF/java/Java.inc
d5 1
a5 1
	cat $(srcdir)/server/META-INF/java/Java.inc | sed 's/\\/\\\\/g;s/"/\\"/g;s/.*/&\\n\\/'  >>$(srcdir)/java_inc.c
d11 16
a26 2
$(srcdir)/server/META-INF/java/Java.inc:
	cat $(srcdir)/server/META-INF/java/JavaBridge.inc $(srcdir)/server/META-INF/java/Options.inc $(srcdir)/server/META-INF/java/Client.inc $(srcdir)/server/META-INF/java/GlobalRef.inc $(srcdir)/server/META-INF/java/NativeParser.inc $(srcdir)/server/META-INF/java/Parser.inc $(srcdir)/server/META-INF/java/Protocol.inc $(srcdir)/server/META-INF/java/SimpleParser.inc $(srcdir)/server/META-INF/java/JavaProxy.inc | sed -f $(srcdir)/server/extract.sed | sed '/\/\*/,/\*\//d' >$(srcdir)/server/META-INF/java/Java.inc
@


1.18
log
@Release-4-1-8
@
text
@d12 1
a12 1
	cat $(srcdir)/server/META-INF/java/JavaBridge.inc $(srcdir)/server/META-INF/java/Options.inc $(srcdir)/server/META-INF/java/Client.inc $(srcdir)/server/META-INF/java/GlobalRef.inc $(srcdir)/server/META-INF/java/JavaProxy.inc $(srcdir)/server/META-INF/java/NativeParser.inc $(srcdir)/server/META-INF/java/Parser.inc $(srcdir)/server/META-INF/java/Protocol.inc $(srcdir)/server/META-INF/java/SimpleParser.inc | sed -f $(srcdir)/server/extract.sed | sed '/\/\*/,/\*\//d' >$(srcdir)/server/META-INF/java/Java.inc
@


1.17
log
@Release-3-1-0
@
text
@d3 12
@


1.16
log
@PR1178795
@
text
@d3 1
a3 1
$(phplibdir)/libnatcJavaBridge.la:
@


1.15
log
@PR1178795
@
text
@d4 1
a4 1
	cd $(srcdir)/server; $(MAKE) CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) `echo $(CFLAGS_CLEAN)|sed 's/-D[^ ]*//g'`" install; mkdir $(INSTALL_ROOT)$(EXTENSION_DIR)
@


1.14
log
@1178795
@
text
@d4 1
a4 1
	cd $(srcdir)/server; $(MAKE) CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) `echo $(CFLAGS_CLEAN)|sed 's/-D[^ ]*//g'`" install; mkdir modules/lib
@


1.13
log
@Release-1.0.8
@
text
@d4 1
a4 1
	cd $(srcdir)/server; $(MAKE) CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) `echo $(CFLAGS_CLEAN)|sed 's/-D[^ ]*//g'`" install
@


1.12
log
@Release-1.0.8
@
text
@a2 38
install_policy:
	enforce=`getenforce`
	setenforce 0
	domains=`find /etc/selinux -type d -name "domains"`
	contexts=`find /etc/selinux -type d -name "file_contexts"`
	n=0;
	for i in $domains; do
	if test -f $i/program/apache.te; then 
	cp php-java-bridge.te $i/program; n=1
	(cd $i/..; make)
	fi
	done
	if test $n = 0; then 
	echo "error: Could not install php-java-bridge.te. Are the SELinux sources and apache installed?"
	setenforce $enforce
	exit 1
	fi

	n=0;
	for i in $contexts; do
	if test -f $i/program/apache.fc; then 
	cp php-java-bridge.fc $i/program; n=1
	(cd $i/..
	make file_contexts/file_contexts 
	touch /var/log/php-java-bridge.log
	setfiles -v file_contexts/file_contexts /usr/lib/php4/RunJavaBridge /var/log/php-java-bridge.log
	)
	fi
	done
	if test $n = 0; then 
	echo "error: Could not install php-java-bridge.fc. Are the SELinux sources and apache installed?"
	setenforce $enforce
	exit 1
	fi
	setenforce $enforce
	echo "SELinux policy files for php-java-bridge installed."
	echo "You must now load the new policy into the kernel."

@


1.11
log
@use java security instead of dropping the process privileges
@
text
@d3 37
d42 1
a42 1
	cd $(srcdir)/server; sh autogen.sh && sh ./configure --with-java="$(PHP_JAVA_HOME)" --with-extdir="$(EXTENSION_DIR)" --libdir="$(phplibdir)" --datadir="$(phplibdir)" --bindir="$(phplibdir)" && $(MAKE) CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) `echo $(CFLAGS_CLEAN)|sed 's/-D[^ ]*//g'`" install
@


1.10
log
@secure mode
@
text
@d5 1
a5 1
	cd $(srcdir)/server; sh autogen.sh && sh ./configure --with-java="$(PHP_JAVA_HOME)" --with-extdir="$(EXTENSION_DIR)" $(SECURE) --libdir="$(phplibdir)" --datadir="$(phplibdir)" --bindir="$(phplibdir)" && make CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) `echo $(CFLAGS_CLEAN)|sed 's/-D[^ ]*//g'`" install
@


1.9
log
@release 1.0.7
@
text
@d5 1
a5 1
	cd $(srcdir)/server; sh autogen.sh && sh ./configure --with-java="$(PHP_JAVA_HOME)" --with-extdir="$(EXTENSION_DIR)" --libdir="$(phplibdir)" --datadir="$(phplibdir)" --bindir="$(phplibdir)" && make CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) `echo $(CFLAGS_CLEAN)|sed 's/-D[^ ]*//g'`" install
@


1.8
log
@compile java with CFLAGS
@
text
@d5 1
a5 1
	cd $(srcdir)/server; sh autogen.sh && sh ./configure --with-java="$(PHP_JAVA_HOME)" --with-extdir="$(EXTENSION_DIR)" --libdir="$(phplibdir)" --datadir="$(phplibdir)" --bindir="$(phplibdir)" && make CFLAGS="$(CFLAGS_CLEAN)" GCJFLAGS="$(GCJFLAGS) $(CFLAGS_CLEAN)" install
@


1.7
log
@compile gcj with m64
@
text
@d5 1
a5 1
	CFLAGS="$(CFLAGS_CLEAN)"; GCJFLAGS="$(GCJFLAGS) $(CFLAGS)" cd $(srcdir)/server; sh autogen.sh && sh ./configure --with-java="$(PHP_JAVA_HOME)" --with-extdir="$(EXTENSION_DIR)" --libdir="$(phplibdir)" --datadir="$(phplibdir)" --bindir="$(phplibdir)" && make install
@


1.6
log
@Solaris and Win98 support
@
text
@d5 1
a5 1
	CFLAGS="$(CFLAGS_CLEAN)"; cd $(srcdir)/server; sh autogen.sh && sh ./configure --with-java="$(PHP_JAVA_HOME)" --with-extdir="$(EXTENSION_DIR)" --libdir="$(phplibdir)" --datadir="$(phplibdir)" --bindir="$(phplibdir)" && make install
@


1.5
log
@solaris test
@
text
@a2 2
$(srcdir)/init_cfg.o: $(srcdir)/init_cfg.c
	$(LIBTOOL) --mode=compile $(CC) -c $(COMMON_FLAGS) ${CFLAGS} -DCFG_CLASSPATH="\"${EXTENSION_DIR}\"" -DCFG_LD_LIBRARY_PATH="\"${EXTENSION_DIR}\"" -DCFG_JAVA="\"${PHP_JAVA_BIN}\"" -DCFG_JAVA_HOME="\"${PHP_JAVA}\"" -DBRIDGE_VERSION=\"`cat VERSION`\" $(srcdir)/init_cfg.c -o $@@
d4 2
a5 16
$(srcdir)/server/natcJavaBridge.c : $(phplibdir)/JavaBridge.class

$(phplibdir)/JavaBridge.class: $(srcdir)/server/JavaBridge.java
	(cd $(srcdir)/server; ${PHP_JAVA}/bin/javac JavaBridge.java && cp JavaBridge*.class `dirname $@@`)

# no JVM: compile bridge into a binary
$(srcdir)/server/natcJavaBridge.o: 
	libtool --mode=compile gcc -c $(COMMON_FLAGS) ${CFLAGS} -o $@@ $(srcdir)/server/natcJavaBridge.c

$(srcdir)/server/JavaBridge.o: $(srcdir)/server/JavaBridge.java
	libtool --mode=compile gcj -c -fjni -o $@@ $(srcdir)/server/JavaBridge.java

all: $(phplibdir)/java

$(phplibdir)/java:  $(phplibdir)/libnatcJavaBridge.la
	if test "$(PHP_JAVA)" = "yes"; then gcj -Wl,--rpath -Wl,$(INSTALL_ROOT)$(EXTENSION_DIR)/ -L$(phplibdir) -lnatcJavaBridge -o $@@ $(srcdir)/server/java.c; fi
@


1.4
log
@check_broken_gcc_installation
@
text
@d21 1
a21 1
	gcj -Wl,--rpath -Wl,$(INSTALL_ROOT)$(EXTENSION_DIR)/ -L$(phplibdir) -lnatcJavaBridge -o $@@ $(srcdir)/server/java.c
@


1.3
log
@The client receives the bridge instance as the first element.  This fixes the classpath bug.
@
text
@d4 1
a4 1
	$(LIBTOOL) --mode=compile $(CC) -c $(COMMON_FLAGS) ${CFLAGS} -DCFG_CLASSPATH="\"${EXTENSION_DIR}\"" -DCFG_LD_LIBRARY_PATH="\"${EXTENSION_DIR}\"" -DCFG_JAVA="\"${PHP_JAVA}/bin/java\"" -DCFG_JAVA_HOME="\"${PHP_JAVA}\"" -DBRIDGE_VERSION=\"`cat VERSION`\" $(srcdir)/init_cfg.c -o $@@
d10 12
@


1.2
log
@pass CFLAGS for -m64
@
text
@d9 1
a9 1
	(cd $(srcdir)/server; ${PHP_JAVA}/bin/javac JavaBridge.java && cp JavaBridge.class $@@)
@


1.1
log
@Initial revision
@
text
@d4 1
a4 1
	$(LIBTOOL) --mode=compile $(CC) -c $(COMMON_FLAGS)  -DCFG_CLASSPATH="\"${EXTENSION_DIR}\"" -DCFG_LD_LIBRARY_PATH="\"${EXTENSION_DIR}\"" -DCFG_JAVA="\"${PHP_JAVA}/bin/java\"" -DCFG_JAVA_HOME="\"${PHP_JAVA}\""  $(srcdir)/init_cfg.c -o $@@
@


1.1.1.1
log
@Initial
@
text
@@
