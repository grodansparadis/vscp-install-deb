head	1.7;
access;
symbols
	Root_Release_7-0-1:1.6
	Release_7-0-1:1.6.0.6
	Release_7-0-0:1.6.0.4
	Root_Release_7-0-0:1.6
	Release-6-2-2:1.6.0.2
	Release-6-1-2-3:1.5
	Root_Release-6-1-2-3:1.5
	Release-6-1-2-2:1.5.0.6
	Root_Release-6-1-2-2:1.5
	debian_version_6_1_2_1-1:1.5
	upstream_version_6_1_2_1:1.5
	Release-6-1-2-1_new:1.5.0.4
	Root_Release-6-1-2-1_new:1.5
	Release-6-1-2-1:1.5.0.2
	Root_Release-6-1-2-1:1.5
	upstream_version_6_1_2:1.4
	debian_version_6_1_2-1:1.4
	Release-6-1-2:1.4.0.46
	Root_Release-6-1-2:1.4
	debian_version_6_1_1-2:1.4
	debian_version_6_1_1-1:1.4
	upstream_version_6_1_1:1.4
	Release-6-1-1:1.4.0.44
	Root_Release-6-1-1:1.4
	Release-6-0-4:1.4.0.42
	Root_Release-6-0-4:1.4
	Release-6-0-3_NEW:1.4.0.38
	Root_Release-6-0-3_NEW:1.4
	Release-6-0-3:1.4.0.40
	Root_Release-6-0-3:1.4
	Release-6-0-0:1.4.0.36
	Root_Release-6-0-0:1.4
	Release-5-5-4-1:1.4.0.34
	Root_Release-5-5-4-1:1.4
	Release-5-5-4:1.4.0.32
	Root_Release-5-5-4:1.4
	Release-5-5-3:1.4.0.30
	ROOT_Release-5-5-3:1.4
	Release-5-5-2:1.4.0.28
	Root_Release-5-5-2:1.4
	debian_version_5_5_1-1:1.4
	Release-5-5-1:1.4.0.24
	upstream_version_5_5_1:1.4
	ROOT_Release-5-5-1:1.4
	debian_version_5_5-1:1.4
	upstream_version_5_5:1.4
	ROOT_Release-5-5:1.4
	Release-5-5:1.4.0.26
	debian_version_5_4_4_2-3:1.4
	Release-5-4-4-2-1:1.4.0.20
	debian_version_5_4_4_2-2:1.4
	debian_version_5_4_4_2-1:1.4
	upstream_version_5_4_4_2:1.4
	debian_version_5_4_4_1-1:1.4
	upstream_version_5_4_4_1:1.4
	debian_version_5_4_4-1:1.4
	upstream_version_5_4_4:1.4
	Release-5-4-4:1.4.0.22
	Root_Release-5-4-4:1.4
	debian_version_5_4_3_2-1:1.4
	upstream_version_5_4_3_2:1.4
	Release_5-4-3-2:1.4.0.18
	Root_Release_5-4-3-2:1.4
	upstream_version_5_4_3_1:1.4
	debian_version_5_4_3_1-1:1.4
	Release-5-4-3:1.4.0.16
	Root_Release-5-4-3:1.4
	Root_Release-5-4-1:1.4
	Release-5-4-1:1.4.0.14
	Root_Release-5-4:1.4
	Release-5-4:1.4.0.12
	upstream_version_5_3_4:1.4
	debian_version_5_3_4-1:1.4
	ROOT_Release-5-3-4:1.4
	Release-5-3-4:1.4.0.10
	ROOT_Release-5-3-3:1.4
	Release-5-3-3:1.4.0.6
	debian_version_5_3_2_1_2-1:1.4
	upstream_version_5_3_2_1_2:1.4
	debian_version_5_3_2_1_1-1:1.4
	debian_version_5_3_2_1_1:1.4
	upstream_version_5_3_2_1_1:1.4
	Root_Release-5-3-2-1:1.4
	Release-5-3-2-1:1.4
	ROOT_RELEASE-5-3-2-1:1.4
	RELEASE-5-3-2-1:1.4.0.8
	Release-5-3-2:1.4.0.4
	Root_Release-5-3-2:1.4
	Root_Release-5-3-1:1.4
	Release-5-3-1:1.4.0.2
	Release-5-2-3-1:1.3.0.24
	Root_Release-5-2-3-1:1.3
	Release-5-2-2-4:1.3.0.22
	Root_Release-5-2-2-4:1.3
	Release-5-2-2-1:1.3.0.20
	Root_Release-5-2-2-1:1.3
	upstream_version_5_2_2:1.3
	debian_version_5_2_2-1:1.3
	Release-5-2-2:1.3.0.18
	ROOT_Release-5-2-2:1.3
	ROOT_Release-5-2-1:1.3
	Release-5-2-1:1.3.0.16
	Release-5-2-0:1.3.0.14
	ROOT_Release-5-2-0:1.3
	ROOT_Release-5-1-2:1.3
	Release-5-1-2:1.3.0.12
	Version-5-1-1:1.3.0.10
	ROOT_Version-5-1-1:1.3
	debian_version_5_1_0-1:1.3
	upstream_version_5_1_0:1.3
	ROOT_Release-5-1-0:1.3
	Release-5-1-0:1.3.0.8
	ROOT_Release-5-0-0:1.3
	Release-5-0-0:1.3.0.6
	Release-4-3-3:1.3.0.4
	ROOT_Release-4-3-3:1.3
	upstream_version_4_3_2:1.3
	debian_version_4_3_2-1:1.3
	ROOT_Release-4-3-2:1.3
	Release-4-3-2:1.3.0.2
	Release-4-3-1:1.2.0.4
	ROOT_Release-4-3-1:1.2
	debian_version_4_3_0-1:1.2
	upstream_version_4_3_0:1.2
	ROOT_Release-4-3-0:1.2
	Release-4-3-0:1.2.0.2
	debian_version_4_2_2-1:1.1
	upstream_version_4_2_2:1.1
	Release-4-1-2:1.1.0.8
	Release-4-0-8:1.1.0.6
	debian_version_4_0_8a-1:1.1
	upstream_version_4_0_8a:1.1
	jostb-debian-ubuntu-patch:1.1.0.4
	debian_version_4_0_8-1:1.1
	upstream_version_4_0_8:1.1
	debian_version_4_0_7-1:1.1
	upstream_version_4_0_7:1.1
	debian_version_4_0_6-1:1.1
	upstream_version_4_0_6:1.1
	debian_version_4_0_2-1:1.1
	upstream_version_4_0_2:1.1
	Release-4-0-2_Root:1.1
	Release-4-0-2:1.1.0.2
	upstream_version_4_0_1:1.1
	debian_version_4_0_1-2:1.1;
locks; strict;
comment	@# @;


1.7
date	2017.04.09.14.00.07;	author jost_boekemeier;	state dead;
branches;
next	1.6;

1.6
date	2017.01.30.22.28.58;	author jost_boekemeier;	state Exp;
branches;
next	1.5;

1.5
date	2010.05.02.11.49.36;	author jost_boekemeier;	state Exp;
branches;
next	1.4;

1.4
date	2008.10.03.15.48.14;	author jost_boekemeier;	state Exp;
branches;
next	1.3;

1.3
date	2007.12.09.15.13.12;	author jost_boekemeier;	state Exp;
branches;
next	1.2;

1.2
date	2007.09.30.16.07.52;	author jost_boekemeier;	state Exp;
branches;
next	1.1;

1.1
date	2007.03.12.20.27.55;	author andremachado;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Release-7.1.1
@
text
@<?php /*-*- mode: php; tab-width:4 -*-*/

  /** java_GlobalRef.php -- a map which keeps a reference to the
   * PHP instances which have been passed to Java.
   * 
   * Copyright (C) 2003-2007 Jost Boekemeier
   * 
   * This file is part of the PHP/Java Bridge.
   * 
   * The PHP/Java Bridge ("the library") is free software; you can
   * redistribute it and/or modify it under the terms of the GNU General
   * Public License as published by the Free Software Foundation; either
   * version 2, or (at your option) any later version.
   * 
   * The library is distributed in the hope that it will be useful, but
   * WITHOUT ANY WARRANTY; without even the implied warranty of
   * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   * General Public License for more details.
   * 
   * You should have received a copy of the GNU General Public License
   * along with the PHP/Java Bridge; see the file COPYING.  If not, write to the
   * Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
   * 02111-1307 USA.
   * 
   * Linking this file statically or dynamically with other modules is
   * making a combined work based on this library.  Thus, the terms and
   * conditions of the GNU General Public License cover the whole
   * combination.
   * 
   * As a special exception, the copyright holders of this library give you
   * permission to link this library with independent modules to produce an
   * executable, regardless of the license terms of these independent
   * modules, and to copy and distribute the resulting executable under
   * terms of your choice, provided that you also meet, for each linked
   * independent module, the terms and conditions of the license of that
   * module.  An independent module is a module which is not derived from
   * or based on this library.  If you modify this library, you may extend
   * this exception to your version of the library, but you are not
   * obligated to do so.  If you do not wish to do so, delete this
   * exception statement from your version. 
   *
   * @@author     Jost Boekemeier
   * @@license    GPL
   * @@link       http://php-java-bridge.sf.net
   */

  /**
   * This class implements a global map which references PHP objects passed to Java
   * In case "java_session()" was called, PHP objects backing the Java proxies are
   * stored in the session allocated from PHP.
   * @@access private
   */
class java_GlobalRef {
  public $map;

  function __construct() {
    $this->map = array();
  }

  function add($object) {
    if(is_null($object)) return 0;
    return array_push($this->map, $object);
  }
  function get($id) {
    if(!$id) return 0;
	return $this->map[--$id];
  }
}
?>
@


1.6
log
@php 7
@
text
@@


1.5
log
@Release-6-1-2-1
@
text
@d56 1
a56 1
  function java_GlobalRef() {
@


1.4
log
@Release-5-3-1
@
text
@d3 43
a45 38
  /* java_GlobalRef.php -- a map which keeps a reference to the
   PHP instances which have been passed to Java.

   Copyright (C) 2003-2007 Jost Boekemeier

   This file is part of the PHP/Java Bridge.

   The PHP/Java Bridge ("the library") is free software; you can
   redistribute it and/or modify it under the terms of the GNU General
   Public License as published by the Free Software Foundation; either
   version 2, or (at your option) any later version.

   The library is distributed in the hope that it will be useful, but
   WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
   General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with the PHP/Java Bridge; see the file COPYING.  If not, write to the
   Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
   02111-1307 USA.

   Linking this file statically or dynamically with other modules is
   making a combined work based on this library.  Thus, the terms and
   conditions of the GNU General Public License cover the whole
   combination.

   As a special exception, the copyright holders of this library give you
   permission to link this library with independent modules to produce an
   executable, regardless of the license terms of these independent
   modules, and to copy and distribute the resulting executable under
   terms of your choice, provided that you also meet, for each linked
   independent module, the terms and conditions of the license of that
   module.  An independent module is a module which is not derived from
   or based on this library.  If you modify this library, you may extend
   this exception to your version of the library, but you are not
   obligated to do so.  If you do not wish to do so, delete this
   exception statement from your version. */
@


1.3
log
@Release-4-3-2
@
text
@a49 2
  public $client;
  public $mapsMerged;
d51 1
a51 1
  function java_GlobalRef($client) {
a52 2
	$this->client = $client;
	$this->mapsMerged = true;
a54 23
  /**
   * If the user has allocated a session, merge the bindings from the
   * session with the bindings allocated in the current script and
   * store the new map into the session.<br>
   *
   * Test case:
   * class C { public $state; function toString() {return "C::$state";} }
   * java_session()-&gt;put("key", java_closure(new C()));
   * @@access private
   */
  function mergeMaps() {
	if(!$this->mapsMerged && array_key_exists($this->client->RUNTIME, "SESSION")) {
	  $map = $_SESSION["JAVA_GLOBAL_REF"];
	  foreach($map as $key=>$val) {
		if(!array_key_exists($this->map, $key)) {
		  $this->map[$key]=$val;
		}
	  }
	  $_SESSION["JAVA_GLOBAL_REF"]=$this->map;
	}
	$this->mapsMerged = true;
  }
	
a56 1
	if(!$this->mapsMerged) $this->mergeMaps();
a60 1
	if(!$this->mapsMerged) $this->mergeMaps();
@


1.2
log
@Release-4-3-0
@
text
@d49 3
a51 3
  var $map;
  var $client;
  var $mapsMerged;
d65 1
a65 1
   * class C { var $state; function toString() {return "C::$state";} }
@


1.1
log
@Further inclusions of 4.0.1 code extracted from src.tgz. Andre Felipe Machado.
@
text
@d42 6
d50 2
d53 1
a53 1
  function java_GlobalRef() {
d55 2
d59 23
d84 1
a86 1

d89 2
a90 1
    return $this->map[--$id];
@

